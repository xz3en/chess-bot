export function parseXMessage(raw) {
    const fieldValues = {};
    let f = undefined;
    let m = 0;
    for (const data of raw[1]){
        if (m % 2 === 0) {
            f = data;
        } else if (f) {
            fieldValues[f] = data;
        }
        m++;
    }
    return {
        xid: parseXId(raw[0]),
        fieldValues: fieldValues
    };
}
export function convertMap(raw) {
    const fieldValues = new Map();
    let f = undefined;
    let m = 0;
    for (const data of raw){
        if (m % 2 === 0 && typeof data === "string") {
            f = data;
        } else if (m % 2 === 1 && f) {
            fieldValues.set(f, data);
        }
        m++;
    }
    return fieldValues;
}
export function parseXReadReply(raw) {
    const out = [];
    for (const [key, idData] of raw){
        const messages = [];
        for (const rawMsg of idData){
            messages.push(parseXMessage(rawMsg));
        }
        out.push({
            key,
            messages
        });
    }
    return out;
}
export function parseXId(raw) {
    const [ms, sn] = raw.split("-");
    return {
        unixMs: parseInt(ms),
        seqNo: parseInt(sn)
    };
}
export function parseXPendingConsumers(raws) {
    const out = [];
    for (const raw of raws){
        if (isCondArray(raw) && isString(raw[0]) && isString(raw[1])) {
            out.push({
                name: raw[0],
                pending: parseInt(raw[1])
            });
        }
    }
    return out;
}
export function parseXPendingCounts(raw) {
    const infos = [];
    for (const r of raw){
        if (isCondArray(r) && isString(r[0]) && isString(r[1]) && isNumber(r[2]) && isNumber(r[3])) {
            infos.push({
                xid: parseXId(r[0]),
                owner: r[1],
                lastDeliveredMs: r[2],
                timesDelivered: r[3]
            });
        }
    }
    return infos;
}
export function parseXGroupDetail(rawGroups) {
    const out = [];
    for (const rawGroup of rawGroups){
        if (isCondArray(rawGroup)) {
            const data = convertMap(rawGroup);
            // array of arrays
            const consDeets = data.get("consumers");
            out.push({
                name: rawstr(data.get("name")),
                lastDeliveredId: parseXId(rawstr(data.get("last-delivered-id"))),
                pelCount: rawnum(data.get("pel-count")),
                pending: parseXPendingCounts(data.get("pending")),
                consumers: parseXConsumerDetail(consDeets)
            });
        }
    }
    return out;
}
export function parseXConsumerDetail(nestedRaws) {
    const out = [];
    for (const raws of nestedRaws){
        const data = convertMap(raws);
        const pending = data.get("pending").map((p)=>{
            return {
                xid: parseXId(rawstr(p[0])),
                lastDeliveredMs: rawnum(p[1]),
                timesDelivered: rawnum(p[2])
            };
        });
        const r = {
            name: rawstr(data.get("name")),
            seenTime: rawnum(data.get("seen-time")),
            pelCount: rawnum(data.get("pel-count")),
            pending
        };
        out.push(r);
    }
    return out;
}
export function xidstr(xid) {
    if (typeof xid === "string") return xid;
    if (typeof xid === "number") return `${xid}-0`;
    if (xid instanceof Array && xid.length > 1) return `${xid[0]}-${xid[1]}`;
    if (isXId(xid)) return `${xid.unixMs}-${xid.seqNo}`;
    throw "fail";
}
export function rawnum(raw) {
    return raw ? +raw.toString() : 0;
}
export function rawstr(raw) {
    return raw ? raw.toString() : "";
}
// deno-lint-ignore no-explicit-any
export function isString(x) {
    return typeof x === "string";
}
// deno-lint-ignore no-explicit-any
export function isNumber(x) {
    return typeof x === "number";
}
export function isCondArray(x) {
    const l = x.length;
    if (l > 0 || l < 1) return true;
    else return false;
}
function isXId(xid) {
    return xid.unixMs !== undefined;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvcmVkaXNAdjAuMjUuMS9zdHJlYW0udHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBDb25kaXRpb25hbEFycmF5LCBSYXcsIFJlZGlzVmFsdWUgfSBmcm9tIFwiLi9wcm90b2NvbC9tb2QudHNcIjtcblxuZXhwb3J0IGludGVyZmFjZSBYSWQge1xuICB1bml4TXM6IG51bWJlcjtcbiAgc2VxTm86IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBYTWVzc2FnZSB7XG4gIHhpZDogWElkO1xuICBmaWVsZFZhbHVlczogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBYS2V5SWQge1xuICBrZXk6IHN0cmluZztcbiAgeGlkOiBYSWRJbnB1dDtcbn1cblxuZXhwb3J0IHR5cGUgWEtleUlkTGlrZSA9IFtzdHJpbmcsIFhJZElucHV0XTtcblxuZXhwb3J0IGludGVyZmFjZSBYS2V5SWRHcm91cCB7XG4gIGtleTogc3RyaW5nO1xuICB4aWQ6IFhJZEdyb3VwUmVhZDtcbn1cblxuZXhwb3J0IHR5cGUgWEtleUlkR3JvdXBMaWtlID0gW3N0cmluZywgWElkR3JvdXBSZWFkXTtcblxuZXhwb3J0IHR5cGUgWFJlYWRTdHJlYW0gPSB7IGtleTogc3RyaW5nOyBtZXNzYWdlczogWE1lc3NhZ2VbXSB9O1xuZXhwb3J0IHR5cGUgWFJlYWRSZXBseSA9IFhSZWFkU3RyZWFtW107XG5cbi8vIGJhc2ljIGRhdGEgcmV0dXJuZWQgYnkgcmVkaXNcbmV4cG9ydCB0eXBlIFhSZWFkSWREYXRhID0gW3N0cmluZywgc3RyaW5nW11dO1xuZXhwb3J0IHR5cGUgWFJlYWRTdHJlYW1SYXcgPSBbc3RyaW5nLCBYUmVhZElkRGF0YVtdXTtcbmV4cG9ydCB0eXBlIFhSZWFkUmVwbHlSYXcgPSBYUmVhZFN0cmVhbVJhd1tdO1xuXG4vKiogRmxleGlibGUgaW5wdXQgdHlwZSBmb3IgY29tbWFuZHMgd2hpY2ggcmVxdWlyZSBtZXNzYWdlXG4gKiBJRCB0byBiZSBwYXNzZWQgKHJlcHJlc2VudGVkIGluIGxvd2VyLWxldmVsIFJlZGlzIEFQSSBhc1xuICogXCIxMDAwLTBcIiBldGMpLlxuICpcbiAqIFdlIGFsc28gaW5jbHVkZSBhbiBhcnJheSBmb3JtYXQgZm9yIGVhc2Ugb2YgdXNlLCB3aGVyZVxuICogdGhlIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGVwb2NoTWlsbGlzLCBzZWNvbmQgaXMgc2VxTm8uXG4gKlxuICogV2UgYWxzbyBhbGxvdyBwYXNzaW5nIGEgc2luZ2xlIG51bWJlcixcbiAqIHdoaWNoIHdpbGwgcmVwcmVzZW50IHRoZSB0aGUgZXBvY2ggTWlsbGlzIHdpdGhcbiAqIHNlcU5vIG9mIHplcm8uICAoRXNwZWNpYWxseSB1c2VmdWwgaXMgdG8gcGFzcyAwLilcbiAqL1xuZXhwb3J0IHR5cGUgWElkSW5wdXQgPVxuICB8IFhJZFxuICB8IFtudW1iZXIsIG51bWJlcl1cbiAgfCBudW1iZXI7XG4vKipcbiAqIElEIGlucHV0IHR5cGUgZm9yIFhBREQsIHdoaWNoIGlzIGFsbG93ZWQgdG8gaW5jbHVkZSB0aGVcbiAqIFwiKlwiIG9wZXJhdG9yLiAqL1xuZXhwb3J0IHR5cGUgWElkQWRkID0gWElkSW5wdXQgfCBcIipcIjtcbi8qKlxuICogSUQgaW5wdXQgdHlwZSBmb3IgWEdST1VQUkVBRCwgd2hpY2ggaXMgYWxsb3dlZCB0byBpbmNsdWRlXG4gKiB0aGUgXCI+XCIgb3BlcmF0b3IuICBXZSBpbmNsdWRlIGFuIGFycmF5IGZvcm1hdCBmb3IgZWFzZSBvZlxuICogdXNlLCB3aGVyZSB0aGUgZmlyc3QgZWxlbWVudCBpcyB0aGUgZXBvY2hNaWxsaXMsIHNlY29uZFxuICogaXMgc2VxTm8uICovXG5leHBvcnQgdHlwZSBYSWRHcm91cFJlYWQgPSBYSWRJbnB1dCB8IFwiPlwiO1xuXG4vKiogQWxsb3dzIHNwZWNpYWwgbWF4aW11bSBJRCBmb3IgWFJBTkdFIGFuZCBYUkVWUkFOR0UgKi9cbmV4cG9ydCB0eXBlIFhJZFBvcyA9IFhJZElucHV0IHwgXCIrXCI7XG4vKiogQWxsb3dzIHNwZWNpYWwgbWluaW11bSBJRCBmb3IgWFJBTkdFIGFuZCBYUkVWUkFOR0UgKi9cbmV4cG9ydCB0eXBlIFhJZE5lZyA9IFhJZElucHV0IHwgXCItXCI7XG4vKiogQWxsb3cgc3BlY2lhbCAkIElEIGZvciBYR1JPVVAgQ1JFQVRFICovXG5leHBvcnQgdHlwZSBYSWRDcmVhdGVHcm91cCA9IFhJZElucHV0IHwgXCIkXCI7XG5cbmV4cG9ydCB0eXBlIFhBZGRGaWVsZFZhbHVlcyA9XG4gIHwgUmVjb3JkPHN0cmluZyB8IG51bWJlciwgUmVkaXNWYWx1ZT5cbiAgfCBNYXA8c3RyaW5nIHwgbnVtYmVyLCBSZWRpc1ZhbHVlPjtcblxuZXhwb3J0IGludGVyZmFjZSBYUmVhZE9wdHMge1xuICBjb3VudD86IG51bWJlcjtcbiAgYmxvY2s/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgWFJlYWRHcm91cE9wdHMge1xuICBncm91cDogc3RyaW5nO1xuICBjb25zdW1lcjogc3RyaW5nO1xuICBjb3VudD86IG51bWJlcjtcbiAgYmxvY2s/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgWE1heGxlbiB7XG4gIGFwcHJveD86IGJvb2xlYW47XG4gIGVsZW1lbnRzOiBudW1iZXI7XG59XG5cbmV4cG9ydCB0eXBlIFhDbGFpbVJlcGx5ID0gWENsYWltTWVzc2FnZXMgfCBYQ2xhaW1KdXN0WElkO1xuZXhwb3J0IGludGVyZmFjZSBYQ2xhaW1NZXNzYWdlcyB7XG4gIGtpbmQ6IFwibWVzc2FnZXNcIjtcbiAgbWVzc2FnZXM6IFhNZXNzYWdlW107XG59XG5leHBvcnQgaW50ZXJmYWNlIFhDbGFpbUp1c3RYSWQge1xuICBraW5kOiBcImp1c3R4aWRcIjtcbiAgeGlkczogWElkW107XG59XG5cbi8qKlxuICogQHBhcmFtIGNvdW50IExpbWl0IG9uIHRoZSBudW1iZXIgb2YgbWVzc2FnZXMgdG8gcmV0dXJuIHBlciBjYWxsLlxuICogQHBhcmFtIHN0YXJ0SWQgSUQgZm9yIHRoZSBmaXJzdCBwZW5kaW5nIHJlY29yZC5cbiAqIEBwYXJhbSBlbmRJZCAgSUQgZm9yIHRoZSBmaW5hbCBwZW5kaW5nIHJlY29yZC5cbiAqIEBwYXJhbSBjb25zdW1lcnMgIEV2ZXJ5IGNvbnN1bWVyIGluIHRoZSBjb25zdW1lciBncm91cFxuICogd2l0aCBhdCBsZWFzdCBvbmUgcGVuZGluZyBtZXNzYWdlLCBhbmQgdGhlIG51bWJlciBvZlxuICogcGVuZGluZyBtZXNzYWdlcyBpdCBoYXMuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgWFBlbmRpbmdSZXBseSB7XG4gIGNvdW50OiBudW1iZXI7XG4gIHN0YXJ0SWQ6IFhJZDtcbiAgZW5kSWQ6IFhJZDtcbiAgY29uc3VtZXJzOiBYUGVuZGluZ0NvbnN1bWVyW107XG59XG5leHBvcnQgaW50ZXJmYWNlIFhQZW5kaW5nQ29uc3VtZXIge1xuICBuYW1lOiBzdHJpbmc7XG4gIHBlbmRpbmc6IG51bWJlcjtcbn1cblxuLyoqXG4gKiBSZXByZXNlbnRzIGEgcGVuZGluZyBtZXNzYWdlIHBhcnNlZCBmcm9tIHhwZW5kaW5nLlxuICpcbiAqIEBwYXJhbSBpZCBUaGUgSUQgb2YgdGhlIG1lc3NhZ2VcbiAqIEBwYXJhbSBjb25zdW1lciBUaGUgbmFtZSBvZiB0aGUgY29uc3VtZXIgdGhhdCBmZXRjaGVkIHRoZSBtZXNzYWdlXG4gKiAgYW5kIGhhcyBzdGlsbCB0byBhY2tub3dsZWRnZSBpdC4gV2UgY2FsbCBpdCB0aGVcbiAqICBjdXJyZW50IG93bmVyIG9mIHRoZSBtZXNzYWdlLlxuICogQHBhcmFtIGxhc3REZWxpdmVyZWRNcyBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0aGF0IGVsYXBzZWQgc2luY2UgdGhlXG4gKiAgbGFzdCB0aW1lIHRoaXMgbWVzc2FnZSB3YXMgZGVsaXZlcmVkIHRvIHRoaXMgY29uc3VtZXIuXG4gKiBAcGFyYW0gdGltZXNEZWxpdmVyZWQgVGhlIG51bWJlciBvZiB0aW1lcyB0aGlzIG1lc3NhZ2Ugd2FzIGRlbGl2ZXJlZC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBYUGVuZGluZ0NvdW50IHtcbiAgeGlkOiBYSWQ7XG4gIG93bmVyOiBzdHJpbmc7XG4gIGxhc3REZWxpdmVyZWRNczogbnVtYmVyO1xuICB0aW1lc0RlbGl2ZXJlZDogbnVtYmVyO1xufVxuLyoqIFVzZWQgaW4gdGhlIFhQRU5ESU5HIGNvbW1hbmQsIGFsbCB0aHJlZSBvZiB0aGVzZVxuICogYXJncyBtdXN0IGJlIHNwZWNpZmllZCBpZiBfYW55XyBhcmUgc3BlY2lmaWVkLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFN0YXJ0RW5kQ291bnQge1xuICBzdGFydDogbnVtYmVyIHwgXCItXCI7XG4gIGVuZDogbnVtYmVyIHwgXCIrXCI7XG4gIGNvdW50OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgWEluZm9TdHJlYW1SZXBseSB7XG4gIGxlbmd0aDogbnVtYmVyO1xuICByYWRpeFRyZWVLZXlzOiBudW1iZXI7XG4gIHJhZGl4VHJlZU5vZGVzOiBudW1iZXI7XG4gIGdyb3VwczogbnVtYmVyO1xuICBsYXN0R2VuZXJhdGVkSWQ6IFhJZDtcbiAgZmlyc3RFbnRyeTogWE1lc3NhZ2U7XG4gIGxhc3RFbnRyeTogWE1lc3NhZ2U7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgWEluZm9TdHJlYW1GdWxsUmVwbHkge1xuICBsZW5ndGg6IG51bWJlcjtcbiAgcmFkaXhUcmVlS2V5czogbnVtYmVyO1xuICByYWRpeFRyZWVOb2RlczogbnVtYmVyO1xuICBsYXN0R2VuZXJhdGVkSWQ6IFhJZDtcbiAgZW50cmllczogWE1lc3NhZ2VbXTtcbiAgZ3JvdXBzOiBYR3JvdXBEZXRhaWxbXTtcbn1cblxuLyoqXG4gKiBDaGlsZCBvZiB0aGUgcmV0dXJuIHR5cGUgZm9yIHhpbmZvX3N0cmVhbV9mdWxsXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgWEdyb3VwRGV0YWlsIHtcbiAgbmFtZTogc3RyaW5nO1xuICBsYXN0RGVsaXZlcmVkSWQ6IFhJZDtcbiAgcGVsQ291bnQ6IG51bWJlcjtcbiAgcGVuZGluZzogWFBlbmRpbmdDb3VudFtdO1xuICBjb25zdW1lcnM6IFhDb25zdW1lckRldGFpbFtdO1xufVxuLyoqIENoaWxkIG9mIFhJTkZPIFNUUkVBTVMgRlVMTCByZXNwb25zZSAqL1xuZXhwb3J0IGludGVyZmFjZSBYQ29uc3VtZXJEZXRhaWwge1xuICBuYW1lOiBzdHJpbmc7XG4gIHNlZW5UaW1lOiBudW1iZXI7XG4gIHBlbENvdW50OiBudW1iZXI7XG4gIHBlbmRpbmc6IHsgeGlkOiBYSWQ7IGxhc3REZWxpdmVyZWRNczogbnVtYmVyOyB0aW1lc0RlbGl2ZXJlZDogbnVtYmVyIH1bXTtcbn1cblxuZXhwb3J0IHR5cGUgWEluZm9Db25zdW1lcnNSZXBseSA9IFhJbmZvQ29uc3VtZXJbXTtcbi8qKlxuICogQSBjb25zdW1lciBwYXJzZWQgZnJvbSB4aW5mbyBjb21tYW5kLlxuICpcbiAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIGNvbnN1bWVyIGdyb3VwLlxuICogQHBhcmFtIHBlbmRpbmcgTnVtYmVyIG9mIHBlbmRpbmcgbWVzc2FnZXMgZm9yIHRoaXMgc3BlY2lmaWMgY29uc3VtZXIuXG4gKiBAcGFyYW0gaWRsZSBUaGlzIGNvbnN1bWVyJ3MgaWRsZSB0aW1lIGluIG1pbGxpc2Vjb25kcy5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBYSW5mb0NvbnN1bWVyIHtcbiAgbmFtZTogc3RyaW5nO1xuICBwZW5kaW5nOiBudW1iZXI7XG4gIGlkbGU6IG51bWJlcjtcbn1cblxuLyoqIFJlc3BvbnNlIHRvIFhJTkZPIEdST1VQUyA8a2V5PiAqL1xuZXhwb3J0IHR5cGUgWEluZm9Hcm91cHNSZXBseSA9IFhJbmZvR3JvdXBbXTtcbmV4cG9ydCBpbnRlcmZhY2UgWEluZm9Hcm91cCB7XG4gIG5hbWU6IHN0cmluZztcbiAgY29uc3VtZXJzOiBudW1iZXI7XG4gIHBlbmRpbmc6IG51bWJlcjtcbiAgbGFzdERlbGl2ZXJlZElkOiBYSWQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgWENsYWltT3B0cyB7XG4gIGdyb3VwOiBzdHJpbmc7XG4gIGNvbnN1bWVyOiBzdHJpbmc7XG4gIG1pbklkbGVUaW1lOiBudW1iZXI7XG4gIGlkbGU/OiBudW1iZXI7XG4gIHRpbWU/OiBudW1iZXI7XG4gIHJldHJ5Q291bnQ/OiBudW1iZXI7XG4gIGZvcmNlPzogYm9vbGVhbjtcbiAganVzdFhJZD86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZVhNZXNzYWdlKFxuICByYXc6IFhSZWFkSWREYXRhLFxuKTogWE1lc3NhZ2Uge1xuICBjb25zdCBmaWVsZFZhbHVlczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9O1xuICBsZXQgZjogc3RyaW5nIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xuXG4gIGxldCBtID0gMDtcbiAgZm9yIChjb25zdCBkYXRhIG9mIHJhd1sxXSkge1xuICAgIGlmIChtICUgMiA9PT0gMCkge1xuICAgICAgZiA9IGRhdGE7XG4gICAgfSBlbHNlIGlmIChmKSB7XG4gICAgICBmaWVsZFZhbHVlc1tmXSA9IGRhdGE7XG4gICAgfVxuICAgIG0rKztcbiAgfVxuXG4gIHJldHVybiB7IHhpZDogcGFyc2VYSWQocmF3WzBdKSwgZmllbGRWYWx1ZXM6IGZpZWxkVmFsdWVzIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0TWFwKHJhdzogQ29uZGl0aW9uYWxBcnJheSk6IE1hcDxzdHJpbmcsIFJhdz4ge1xuICBjb25zdCBmaWVsZFZhbHVlczogTWFwPHN0cmluZywgUmF3PiA9IG5ldyBNYXAoKTtcbiAgbGV0IGY6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcblxuICBsZXQgbSA9IDA7XG4gIGZvciAoY29uc3QgZGF0YSBvZiByYXcpIHtcbiAgICBpZiAobSAlIDIgPT09IDAgJiYgdHlwZW9mIGRhdGEgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIGYgPSBkYXRhO1xuICAgIH0gZWxzZSBpZiAobSAlIDIgPT09IDEgJiYgZikge1xuICAgICAgZmllbGRWYWx1ZXMuc2V0KGYsIGRhdGEpO1xuICAgIH1cbiAgICBtKys7XG4gIH1cblxuICByZXR1cm4gZmllbGRWYWx1ZXM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZVhSZWFkUmVwbHkoXG4gIHJhdzogWFJlYWRSZXBseVJhdyxcbik6IFhSZWFkUmVwbHkge1xuICBjb25zdCBvdXQ6IFhSZWFkU3RyZWFtW10gPSBbXTtcbiAgZm9yIChjb25zdCBba2V5LCBpZERhdGFdIG9mIHJhdykge1xuICAgIGNvbnN0IG1lc3NhZ2VzID0gW107XG4gICAgZm9yIChjb25zdCByYXdNc2cgb2YgaWREYXRhKSB7XG4gICAgICBtZXNzYWdlcy5wdXNoKHBhcnNlWE1lc3NhZ2UocmF3TXNnKSk7XG4gICAgfVxuICAgIG91dC5wdXNoKHsga2V5LCBtZXNzYWdlcyB9KTtcbiAgfVxuXG4gIHJldHVybiBvdXQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZVhJZChyYXc6IHN0cmluZyk6IFhJZCB7XG4gIGNvbnN0IFttcywgc25dID0gcmF3LnNwbGl0KFwiLVwiKTtcbiAgcmV0dXJuIHsgdW5peE1zOiBwYXJzZUludChtcyksIHNlcU5vOiBwYXJzZUludChzbikgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlWFBlbmRpbmdDb25zdW1lcnMoXG4gIHJhd3M6IENvbmRpdGlvbmFsQXJyYXksXG4pOiBYUGVuZGluZ0NvbnN1bWVyW10ge1xuICBjb25zdCBvdXQ6IFhQZW5kaW5nQ29uc3VtZXJbXSA9IFtdO1xuXG4gIGZvciAoY29uc3QgcmF3IG9mIHJhd3MpIHtcbiAgICBpZiAoaXNDb25kQXJyYXkocmF3KSAmJiBpc1N0cmluZyhyYXdbMF0pICYmIGlzU3RyaW5nKHJhd1sxXSkpIHtcbiAgICAgIG91dC5wdXNoKHsgbmFtZTogcmF3WzBdLCBwZW5kaW5nOiBwYXJzZUludChyYXdbMV0pIH0pO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBvdXQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZVhQZW5kaW5nQ291bnRzKHJhdzogQ29uZGl0aW9uYWxBcnJheSk6IFhQZW5kaW5nQ291bnRbXSB7XG4gIGNvbnN0IGluZm9zOiBYUGVuZGluZ0NvdW50W10gPSBbXTtcbiAgZm9yIChjb25zdCByIG9mIHJhdykge1xuICAgIGlmIChcbiAgICAgIGlzQ29uZEFycmF5KHIpICYmIGlzU3RyaW5nKHJbMF0pICYmXG4gICAgICBpc1N0cmluZyhyWzFdKSAmJiBpc051bWJlcihyWzJdKSAmJlxuICAgICAgaXNOdW1iZXIoclszXSlcbiAgICApIHtcbiAgICAgIGluZm9zLnB1c2goXG4gICAgICAgIHtcbiAgICAgICAgICB4aWQ6IHBhcnNlWElkKHJbMF0pLFxuICAgICAgICAgIG93bmVyOiByWzFdLFxuICAgICAgICAgIGxhc3REZWxpdmVyZWRNczogclsyXSxcbiAgICAgICAgICB0aW1lc0RlbGl2ZXJlZDogclszXSxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGluZm9zO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VYR3JvdXBEZXRhaWwocmF3R3JvdXBzOiBDb25kaXRpb25hbEFycmF5KTogWEdyb3VwRGV0YWlsW10ge1xuICBjb25zdCBvdXQgPSBbXTtcblxuICBmb3IgKGNvbnN0IHJhd0dyb3VwIG9mIHJhd0dyb3Vwcykge1xuICAgIGlmIChpc0NvbmRBcnJheShyYXdHcm91cCkpIHtcbiAgICAgIGNvbnN0IGRhdGEgPSBjb252ZXJ0TWFwKHJhd0dyb3VwKTtcblxuICAgICAgLy8gYXJyYXkgb2YgYXJyYXlzXG4gICAgICBjb25zdCBjb25zRGVldHMgPSBkYXRhLmdldChcImNvbnN1bWVyc1wiKSBhcyBDb25kaXRpb25hbEFycmF5W107XG5cbiAgICAgIG91dC5wdXNoKFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogcmF3c3RyKGRhdGEuZ2V0KFwibmFtZVwiKSksXG4gICAgICAgICAgbGFzdERlbGl2ZXJlZElkOiBwYXJzZVhJZChyYXdzdHIoZGF0YS5nZXQoXCJsYXN0LWRlbGl2ZXJlZC1pZFwiKSkpLFxuICAgICAgICAgIHBlbENvdW50OiByYXdudW0oZGF0YS5nZXQoXCJwZWwtY291bnRcIikpLFxuICAgICAgICAgIHBlbmRpbmc6IHBhcnNlWFBlbmRpbmdDb3VudHMoXG4gICAgICAgICAgICBkYXRhLmdldChcInBlbmRpbmdcIikgYXMgQ29uZGl0aW9uYWxBcnJheSxcbiAgICAgICAgICApLFxuICAgICAgICAgIGNvbnN1bWVyczogcGFyc2VYQ29uc3VtZXJEZXRhaWwoXG4gICAgICAgICAgICBjb25zRGVldHMsXG4gICAgICAgICAgKSxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG91dDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlWENvbnN1bWVyRGV0YWlsKFxuICBuZXN0ZWRSYXdzOiBSYXdbXVtdLFxuKTogWENvbnN1bWVyRGV0YWlsW10ge1xuICBjb25zdCBvdXQ6IFhDb25zdW1lckRldGFpbFtdID0gW107XG5cbiAgZm9yIChjb25zdCByYXdzIG9mIG5lc3RlZFJhd3MpIHtcbiAgICBjb25zdCBkYXRhID0gY29udmVydE1hcChyYXdzKTtcblxuICAgIGNvbnN0IHBlbmRpbmcgPSAoZGF0YS5nZXQoXCJwZW5kaW5nXCIpIGFzIFtzdHJpbmcsIG51bWJlciwgbnVtYmVyXVtdKS5tYXAoXG4gICAgICAocCkgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHhpZDogcGFyc2VYSWQocmF3c3RyKHBbMF0pKSxcbiAgICAgICAgICBsYXN0RGVsaXZlcmVkTXM6IHJhd251bShwWzFdKSxcbiAgICAgICAgICB0aW1lc0RlbGl2ZXJlZDogcmF3bnVtKHBbMl0pLFxuICAgICAgICB9O1xuICAgICAgfSxcbiAgICApO1xuXG4gICAgY29uc3QgciA9IHtcbiAgICAgIG5hbWU6IHJhd3N0cihkYXRhLmdldChcIm5hbWVcIikpLFxuICAgICAgc2VlblRpbWU6IHJhd251bShkYXRhLmdldChcInNlZW4tdGltZVwiKSksXG4gICAgICBwZWxDb3VudDogcmF3bnVtKGRhdGEuZ2V0KFwicGVsLWNvdW50XCIpKSxcbiAgICAgIHBlbmRpbmcsXG4gICAgfTtcblxuICAgIG91dC5wdXNoKHIpO1xuICB9XG5cbiAgcmV0dXJuIG91dDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHhpZHN0cihcbiAgeGlkOiBYSWRBZGQgfCBYSWROZWcgfCBYSWRQb3MgfCBYSWRDcmVhdGVHcm91cCB8IFhJZEdyb3VwUmVhZCxcbikge1xuICBpZiAodHlwZW9mIHhpZCA9PT0gXCJzdHJpbmdcIikgcmV0dXJuIHhpZDtcbiAgaWYgKHR5cGVvZiB4aWQgPT09IFwibnVtYmVyXCIpIHJldHVybiBgJHt4aWR9LTBgO1xuICBpZiAoeGlkIGluc3RhbmNlb2YgQXJyYXkgJiYgeGlkLmxlbmd0aCA+IDEpIHJldHVybiBgJHt4aWRbMF19LSR7eGlkWzFdfWA7XG4gIGlmIChpc1hJZCh4aWQpKSByZXR1cm4gYCR7eGlkLnVuaXhNc30tJHt4aWQuc2VxTm99YDtcbiAgdGhyb3cgXCJmYWlsXCI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByYXdudW0ocmF3OiBSYXcpOiBudW1iZXIge1xuICByZXR1cm4gcmF3ID8gK3Jhdy50b1N0cmluZygpIDogMDtcbn1cbmV4cG9ydCBmdW5jdGlvbiByYXdzdHIocmF3OiBSYXcpOiBzdHJpbmcge1xuICByZXR1cm4gcmF3ID8gcmF3LnRvU3RyaW5nKCkgOiBcIlwiO1xufVxuLy8gZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbmV4cG9ydCBmdW5jdGlvbiBpc1N0cmluZyh4OiBhbnkpOiB4IGlzIHN0cmluZyB7XG4gIHJldHVybiB0eXBlb2YgeCA9PT0gXCJzdHJpbmdcIjtcbn1cblxuLy8gZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbmV4cG9ydCBmdW5jdGlvbiBpc051bWJlcih4OiBhbnkpOiB4IGlzIG51bWJlciB7XG4gIHJldHVybiB0eXBlb2YgeCA9PT0gXCJudW1iZXJcIjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzQ29uZEFycmF5KHg6IFJhdyk6IHggaXMgQ29uZGl0aW9uYWxBcnJheSB7XG4gIGNvbnN0IGwgPSAoeCBhcyBDb25kaXRpb25hbEFycmF5KS5sZW5ndGg7XG4gIGlmIChsID4gMCB8fCBsIDwgMSkgcmV0dXJuIHRydWU7XG4gIGVsc2UgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBpc1hJZCh4aWQ6IFhJZEFkZCk6IHhpZCBpcyBYSWQge1xuICByZXR1cm4gKHhpZCBhcyBYSWQpLnVuaXhNcyAhPT0gdW5kZWZpbmVkO1xufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQXNOQSxPQUFPLFNBQVMsY0FDZCxHQUFnQixFQUNOO0lBQ1YsTUFBTSxjQUFzQyxDQUFDO0lBQzdDLElBQUksSUFBd0I7SUFFNUIsSUFBSSxJQUFJO0lBQ1IsS0FBSyxNQUFNLFFBQVEsR0FBRyxDQUFDLEVBQUUsQ0FBRTtRQUN6QixJQUFJLElBQUksTUFBTSxHQUFHO1lBQ2YsSUFBSTtRQUNOLE9BQU8sSUFBSSxHQUFHO1lBQ1osV0FBVyxDQUFDLEVBQUUsR0FBRztRQUNuQixDQUFDO1FBQ0Q7SUFDRjtJQUVBLE9BQU87UUFBRSxLQUFLLFNBQVMsR0FBRyxDQUFDLEVBQUU7UUFBRyxhQUFhO0lBQVk7QUFDM0QsQ0FBQztBQUVELE9BQU8sU0FBUyxXQUFXLEdBQXFCLEVBQW9CO0lBQ2xFLE1BQU0sY0FBZ0MsSUFBSTtJQUMxQyxJQUFJLElBQXdCO0lBRTVCLElBQUksSUFBSTtJQUNSLEtBQUssTUFBTSxRQUFRLElBQUs7UUFDdEIsSUFBSSxJQUFJLE1BQU0sS0FBSyxPQUFPLFNBQVMsVUFBVTtZQUMzQyxJQUFJO1FBQ04sT0FBTyxJQUFJLElBQUksTUFBTSxLQUFLLEdBQUc7WUFDM0IsWUFBWSxHQUFHLENBQUMsR0FBRztRQUNyQixDQUFDO1FBQ0Q7SUFDRjtJQUVBLE9BQU87QUFDVCxDQUFDO0FBRUQsT0FBTyxTQUFTLGdCQUNkLEdBQWtCLEVBQ047SUFD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