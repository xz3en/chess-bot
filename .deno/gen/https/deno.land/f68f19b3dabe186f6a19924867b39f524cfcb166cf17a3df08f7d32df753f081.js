import { ChannelThreadsManager } from '../managers/channelThreads.ts';
import { CHANNEL } from '../types/endpoint.ts';
import { GuildChannel } from './channel.ts';
export class GuildThreadAvailableChannel extends GuildChannel {
    topic;
    slowmode;
    defaultThreadSlowmode;
    defaultAutoArchiveDuration;
    threads;
    constructor(client, data, guild){
        super(client, data, guild);
        this.readFromData(data);
        this.threads = new ChannelThreadsManager(this.client, this.guild.threads, this);
    }
    readFromData(data) {
        super.readFromData(data);
        this.defaultThreadSlowmode = data.default_thread_rate_limit_per_user ?? this.defaultThreadSlowmode;
        this.defaultAutoArchiveDuration = data.default_auto_archive_duration ?? this.defaultAutoArchiveDuration;
        this.topic = data.topic ?? this.topic;
    }
    /** Edit the Guild Text Channel */ async edit(options) {
        const body = {
            name: options?.name,
            position: options?.position,
            permission_overwrites: options?.permissionOverwrites,
            parent_id: options?.parentID,
            nsfw: options?.nsfw,
            topic: options?.topic,
            rate_limit_per_user: options?.slowmode,
            default_auto_archive_duration: options?.defaultAutoArchiveDuration,
            default_thread_rate_limit_per_user: options?.defaultThreadSlowmode
        };
        const resp = await this.client.rest.patch(CHANNEL(this.id), body);
        return new GuildThreadAvailableChannel(this.client, resp, this.guild);
    }
    /** Edit topic of the channel */ async setTopic(topic) {
        return await this.edit({
            topic
        });
    }
    /** Edit Slowmode of the channel */ async setSlowmode(slowmode) {
        return await this.edit({
            slowmode: slowmode ?? null
        });
    }
    /** Edit Default Slowmode of the threads in the channel */ async setDefaultThreadSlowmode(slowmode) {
        return await this.edit({
            defaultThreadSlowmode: slowmode ?? null
        });
    }
    /** Edit Default Auto Archive Duration of threads */ async setDefaultAutoArchiveDuration(slowmode) {
        return await this.edit({
            defaultAutoArchiveDuration: slowmode ?? null
        });
    }
    async startThread(options, message) {
        const payload = message !== undefined ? await this.client.rest.endpoints.startPublicThreadFromMessage(this.id, typeof message === 'string' ? message : message.id, {
            name: options.name,
            auto_archive_duration: options.autoArchiveDuration,
            rate_limit_per_user: options.slowmode
        }) : await this.client.rest.endpoints.startThreadWithoutMessage(this.id, {
            name: options.name,
            auto_archive_duration: options.autoArchiveDuration,
            rate_limit_per_user: options.slowmode,
            invitable: options.invitable,
            type: options.type
        });
        await this.client.channels.set(payload.id, payload);
        return await this.client.channels.get(payload.id);
    }
    async startPrivateThread(options) {
        const payload = await this.client.rest.endpoints.startPrivateThread(this.id, {
            name: options.name,
            auto_archive_duration: options.autoArchiveDuration
        });
        await this.client.channels.set(payload.id, payload);
        return await this.client.channels.get(payload.id);
    }
    async fetchArchivedThreads(type = 'public', params = {}) {
        const data = type === 'public' ? await this.client.rest.endpoints.getPublicArchivedThreads(this.id, params) : await this.client.rest.endpoints.getPrivateArchivedThreads(this.id, params);
        const threads = [];
        const members = [];
        for (const d of data.threads){
            await this.threads.set(d.id, d);
            threads.push(await this.threads.get(d.id));
        }
        for (const d1 of data.members){
            const thread = threads.find((e)=>e.id === d1.id) ?? await this.threads.get(d1.id);
            if (thread !== undefined) {
                await thread.members.set(d1.user_id, d1);
                members.push(await thread.members.get(d1.user_id));
            }
        }
        return {
            threads,
            members,
            hasMore: data.has_more
        };
    }
    async fetchPublicArchivedThreads(params = {}) {
        return await this.fetchArchivedThreads('public', params);
    }
    async fetchPrivateArchivedThreads(params = {}) {
        return await this.fetchArchivedThreads('private', params);
    }
    async fetchJoinedPrivateArchivedThreads(params = {}) {
        const data = await this.client.rest.endpoints.getJoinedPrivateArchivedThreads(this.id, params);
        const threads = [];
        const members = [];
        for (const d of data.threads){
            await this.threads.set(d.id, d);
            threads.push(await this.threads.get(d.id));
        }
        for (const d1 of data.members){
            const thread = threads.find((e)=>e.id === d1.id) ?? await this.threads.get(d1.id);
            if (thread !== undefined) {
                await thread.members.set(d1.user_id, d1);
                members.push(await thread.members.get(d1.user_id));
            }
        }
        return {
            threads,
            members,
            hasMore: data.has_more
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvaGFybW9ueUB2Mi45LjAvc3JjL3N0cnVjdHVyZXMvZ3VpbGRUaHJlYWRBdmFpbGFibGVDaGFubmVsLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENsaWVudCB9IGZyb20gJy4uL2NsaWVudC9jbGllbnQudHMnXG5pbXBvcnQgeyBDaGFubmVsVGhyZWFkc01hbmFnZXIgfSBmcm9tICcuLi9tYW5hZ2Vycy9jaGFubmVsVGhyZWFkcy50cydcbmltcG9ydCB7XG4gIENoYW5uZWxUeXBlcyxcbiAgR3VpbGRUaHJlYWRBdmFpbGFibGVDaGFubmVsUGF5bG9hZCxcbiAgTW9kaWZ5R3VpbGRUaHJlYWRBdmFpbGFibGVDaGFubmVsT3B0aW9uLFxuICBNb2RpZnlHdWlsZFRocmVhZEF2YWlsYWJsZUNoYW5uZWxQYXlsb2FkXG59IGZyb20gJy4uL3R5cGVzL2NoYW5uZWwudHMnXG5pbXBvcnQgeyBDSEFOTkVMIH0gZnJvbSAnLi4vdHlwZXMvZW5kcG9pbnQudHMnXG5pbXBvcnQgeyBHdWlsZENoYW5uZWwgfSBmcm9tICcuL2NoYW5uZWwudHMnXG5pbXBvcnQgeyBHdWlsZCB9IGZyb20gJy4vZ3VpbGQudHMnXG5pbXBvcnQgeyBNZXNzYWdlIH0gZnJvbSAnLi9tZXNzYWdlLnRzJ1xuaW1wb3J0IHsgVGhyZWFkQ2hhbm5lbCwgVGhyZWFkTWVtYmVyIH0gZnJvbSAnLi90aHJlYWRDaGFubmVsLnRzJ1xuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVRocmVhZE9wdGlvbnMge1xuICAvKiogMi0xMDAgY2hhcmFjdGVyIGNoYW5uZWwgbmFtZSAqL1xuICBuYW1lOiBzdHJpbmdcbiAgLyoqIGR1cmF0aW9uIGluIG1pbnV0ZXMgdG8gYXV0b21hdGljYWxseSBhcmNoaXZlIHRoZSB0aHJlYWQgYWZ0ZXIgcmVjZW50IGFjdGl2aXR5LCBjYW4gYmUgc2V0IHRvOiA2MCwgMTQ0MCwgNDMyMCwgMTAwODAgKi9cbiAgYXV0b0FyY2hpdmVEdXJhdGlvbj86IG51bWJlclxuICBzbG93bW9kZT86IG51bWJlciB8IG51bGxcbiAgdHlwZT86IENoYW5uZWxUeXBlc1xuICBpbnZpdGFibGU/OiBib29sZWFuXG59XG5cbmV4cG9ydCBjbGFzcyBHdWlsZFRocmVhZEF2YWlsYWJsZUNoYW5uZWwgZXh0ZW5kcyBHdWlsZENoYW5uZWwge1xuICB0b3BpYz86IHN0cmluZ1xuICBzbG93bW9kZSE6IG51bWJlclxuICBkZWZhdWx0VGhyZWFkU2xvd21vZGU/OiBudW1iZXJcbiAgZGVmYXVsdEF1dG9BcmNoaXZlRHVyYXRpb24/OiBudW1iZXJcbiAgdGhyZWFkczogQ2hhbm5lbFRocmVhZHNNYW5hZ2VyXG5cbiAgY29uc3RydWN0b3IoXG4gICAgY2xpZW50OiBDbGllbnQsXG4gICAgZGF0YTogR3VpbGRUaHJlYWRBdmFpbGFibGVDaGFubmVsUGF5bG9hZCxcbiAgICBndWlsZDogR3VpbGRcbiAgKSB7XG4gICAgc3VwZXIoY2xpZW50LCBkYXRhLCBndWlsZClcbiAgICB0aGlzLnJlYWRGcm9tRGF0YShkYXRhKVxuICAgIHRoaXMudGhyZWFkcyA9IG5ldyBDaGFubmVsVGhyZWFkc01hbmFnZXIoXG4gICAgICB0aGlzLmNsaWVudCxcbiAgICAgIHRoaXMuZ3VpbGQudGhyZWFkcyxcbiAgICAgIHRoaXNcbiAgICApXG4gIH1cblxuICByZWFkRnJvbURhdGEoZGF0YTogR3VpbGRUaHJlYWRBdmFpbGFibGVDaGFubmVsUGF5bG9hZCk6IHZvaWQge1xuICAgIHN1cGVyLnJlYWRGcm9tRGF0YShkYXRhKVxuICAgIHRoaXMuZGVmYXVsdFRocmVhZFNsb3dtb2RlID1cbiAgICAgIGRhdGEuZGVmYXVsdF90aHJlYWRfcmF0ZV9saW1pdF9wZXJfdXNlciA/PyB0aGlzLmRlZmF1bHRUaHJlYWRTbG93bW9kZVxuICAgIHRoaXMuZGVmYXVsdEF1dG9BcmNoaXZlRHVyYXRpb24gPVxuICAgICAgZGF0YS5kZWZhdWx0X2F1dG9fYXJjaGl2ZV9kdXJhdGlvbiA/PyB0aGlzLmRlZmF1bHRBdXRvQXJjaGl2ZUR1cmF0aW9uXG4gICAgdGhpcy50b3BpYyA9IGRhdGEudG9waWMgPz8gdGhpcy50b3BpY1xuICB9XG5cbiAgLyoqIEVkaXQgdGhlIEd1aWxkIFRleHQgQ2hhbm5lbCAqL1xuICBhc3luYyBlZGl0KFxuICAgIG9wdGlvbnM/OiBNb2RpZnlHdWlsZFRocmVhZEF2YWlsYWJsZUNoYW5uZWxPcHRpb25cbiAgKTogUHJvbWlzZTxHdWlsZFRocmVhZEF2YWlsYWJsZUNoYW5uZWw+IHtcbiAgICBjb25zdCBib2R5OiBNb2RpZnlHdWlsZFRocmVhZEF2YWlsYWJsZUNoYW5uZWxQYXlsb2FkID0ge1xuICAgICAgbmFtZTogb3B0aW9ucz8ubmFtZSxcbiAgICAgIHBvc2l0aW9uOiBvcHRpb25zPy5wb3NpdGlvbixcbiAgICAgIHBlcm1pc3Npb25fb3ZlcndyaXRlczogb3B0aW9ucz8ucGVybWlzc2lvbk92ZXJ3cml0ZXMsXG4gICAgICBwYXJlbnRfaWQ6IG9wdGlvbnM/LnBhcmVudElELFxuICAgICAgbnNmdzogb3B0aW9ucz8ubnNmdyxcbiAgICAgIHRvcGljOiBvcHRpb25zPy50b3BpYyxcbiAgICAgIHJhdGVfbGltaXRfcGVyX3VzZXI6IG9wdGlvbnM/LnNsb3dtb2RlLFxuICAgICAgZGVmYXVsdF9hdXRvX2FyY2hpdmVfZHVyYXRpb246IG9wdGlvbnM/LmRlZmF1bHRBdXRvQXJjaGl2ZUR1cmF0aW9uLFxuICAgICAgZGVmYXVsdF90aHJlYWRfcmF0ZV9saW1pdF9wZXJfdXNlcjogb3B0aW9ucz8uZGVmYXVsdFRocmVhZFNsb3dtb2RlXG4gICAgfVxuXG4gICAgY29uc3QgcmVzcCA9IGF3YWl0IHRoaXMuY2xpZW50LnJlc3QucGF0Y2goQ0hBTk5FTCh0aGlzLmlkKSwgYm9keSlcblxuICAgIHJldHVybiBuZXcgR3VpbGRUaHJlYWRBdmFpbGFibGVDaGFubmVsKHRoaXMuY2xpZW50LCByZXNwLCB0aGlzLmd1aWxkKVxuICB9XG5cbiAgLyoqIEVkaXQgdG9waWMgb2YgdGhlIGNoYW5uZWwgKi9cbiAgYXN5bmMgc2V0VG9waWModG9waWM6IHN0cmluZyk6IFByb21pc2U8R3VpbGRUaHJlYWRBdmFpbGFibGVDaGFubmVsPiB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZWRpdCh7IHRvcGljIH0pXG4gIH1cblxuICAvKiogRWRpdCBTbG93bW9kZSBvZiB0aGUgY2hhbm5lbCAqL1xuICBhc3luYyBzZXRTbG93bW9kZShcbiAgICBzbG93bW9kZT86IG51bWJlciB8IG51bGxcbiAgKTogUHJvbWlzZTxHdWlsZFRocmVhZEF2YWlsYWJsZUNoYW5uZWw+IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5lZGl0KHsgc2xvd21vZGU6IHNsb3dtb2RlID8/IG51bGwgfSlcbiAgfVxuXG4gIC8qKiBFZGl0IERlZmF1bHQgU2xvd21vZGUgb2YgdGhlIHRocmVhZHMgaW4gdGhlIGNoYW5uZWwgKi9cbiAgYXN5bmMgc2V0RGVmYXVsdFRocmVhZFNsb3dtb2RlKFxuICAgIHNsb3dtb2RlPzogbnVtYmVyIHwgbnVsbFxuICApOiBQcm9taXNlPEd1aWxkVGhyZWFkQXZhaWxhYmxlQ2hhbm5lbD4ge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmVkaXQoeyBkZWZhdWx0VGhyZWFkU2xvd21vZGU6IHNsb3dtb2RlID8/IG51bGwgfSlcbiAgfVxuXG4gIC8qKiBFZGl0IERlZmF1bHQgQXV0byBBcmNoaXZlIER1cmF0aW9uIG9mIHRocmVhZHMgKi9cbiAgYXN5bmMgc2V0RGVmYXVsdEF1dG9BcmNoaXZlRHVyYXRpb24oXG4gICAgc2xvd21vZGU/OiBudW1iZXIgfCBudWxsXG4gICk6IFByb21pc2U8R3VpbGRUaHJlYWRBdmFpbGFibGVDaGFubmVsPiB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZWRpdCh7IGRlZmF1bHRBdXRvQXJjaGl2ZUR1cmF0aW9uOiBzbG93bW9kZSA/PyBudWxsIH0pXG4gIH1cblxuICBhc3luYyBzdGFydFRocmVhZChcbiAgICBvcHRpb25zOiBDcmVhdGVUaHJlYWRPcHRpb25zLFxuICAgIG1lc3NhZ2U/OiBNZXNzYWdlIHwgc3RyaW5nXG4gICk6IFByb21pc2U8VGhyZWFkQ2hhbm5lbD4ge1xuICAgIGNvbnN0IHBheWxvYWQgPVxuICAgICAgbWVzc2FnZSAhPT0gdW5kZWZpbmVkXG4gICAgICAgID8gYXdhaXQgdGhpcy5jbGllbnQucmVzdC5lbmRwb2ludHMuc3RhcnRQdWJsaWNUaHJlYWRGcm9tTWVzc2FnZShcbiAgICAgICAgICAgIHRoaXMuaWQsXG4gICAgICAgICAgICB0eXBlb2YgbWVzc2FnZSA9PT0gJ3N0cmluZycgPyBtZXNzYWdlIDogbWVzc2FnZS5pZCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgbmFtZTogb3B0aW9ucy5uYW1lLFxuICAgICAgICAgICAgICBhdXRvX2FyY2hpdmVfZHVyYXRpb246IG9wdGlvbnMuYXV0b0FyY2hpdmVEdXJhdGlvbixcbiAgICAgICAgICAgICAgcmF0ZV9saW1pdF9wZXJfdXNlcjogb3B0aW9ucy5zbG93bW9kZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIClcbiAgICAgICAgOiBhd2FpdCB0aGlzLmNsaWVudC5yZXN0LmVuZHBvaW50cy5zdGFydFRocmVhZFdpdGhvdXRNZXNzYWdlKHRoaXMuaWQsIHtcbiAgICAgICAgICAgIG5hbWU6IG9wdGlvbnMubmFtZSxcbiAgICAgICAgICAgIGF1dG9fYXJjaGl2ZV9kdXJhdGlvbjogb3B0aW9ucy5hdXRvQXJjaGl2ZUR1cmF0aW9uLFxuICAgICAgICAgICAgcmF0ZV9saW1pdF9wZXJfdXNlcjogb3B0aW9ucy5zbG93bW9kZSxcbiAgICAgICAgICAgIGludml0YWJsZTogb3B0aW9ucy5pbnZpdGFibGUsXG4gICAgICAgICAgICB0eXBlOiBvcHRpb25zLnR5cGVcbiAgICAgICAgICB9KVxuICAgIGF3YWl0IHRoaXMuY2xpZW50LmNoYW5uZWxzLnNldChwYXlsb2FkLmlkLCBwYXlsb2FkKVxuICAgIHJldHVybiAoYXdhaXQgdGhpcy5jbGllbnQuY2hhbm5lbHMuZ2V0PFRocmVhZENoYW5uZWw+KHBheWxvYWQuaWQpKSFcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0UHJpdmF0ZVRocmVhZChcbiAgICBvcHRpb25zOiBDcmVhdGVUaHJlYWRPcHRpb25zXG4gICk6IFByb21pc2U8VGhyZWFkQ2hhbm5lbD4ge1xuICAgIGNvbnN0IHBheWxvYWQgPSBhd2FpdCB0aGlzLmNsaWVudC5yZXN0LmVuZHBvaW50cy5zdGFydFByaXZhdGVUaHJlYWQoXG4gICAgICB0aGlzLmlkLFxuICAgICAgeyBuYW1lOiBvcHRpb25zLm5hbWUsIGF1dG9fYXJjaGl2ZV9kdXJhdGlvbjogb3B0aW9ucy5hdXRvQXJjaGl2ZUR1cmF0aW9uIH1cbiAgICApXG4gICAgYXdhaXQgdGhpcy5jbGllbnQuY2hhbm5lbHMuc2V0KHBheWxvYWQuaWQsIHBheWxvYWQpXG4gICAgcmV0dXJuIChhd2FpdCB0aGlzLmNsaWVudC5jaGFubmVscy5nZXQ8VGhyZWFkQ2hhbm5lbD4ocGF5bG9hZC5pZCkpIVxuICB9XG5cbiAgYXN5bmMgZmV0Y2hBcmNoaXZlZFRocmVhZHMoXG4gICAgdHlwZTogJ3B1YmxpYycgfCAncHJpdmF0ZScgPSAncHVibGljJyxcbiAgICBwYXJhbXM6IHsgYmVmb3JlPzogc3RyaW5nOyBsaW1pdD86IG51bWJlciB9ID0ge31cbiAgKTogUHJvbWlzZTx7XG4gICAgdGhyZWFkczogVGhyZWFkQ2hhbm5lbFtdXG4gICAgbWVtYmVyczogVGhyZWFkTWVtYmVyW11cbiAgICBoYXNNb3JlOiBib29sZWFuXG4gIH0+IHtcbiAgICBjb25zdCBkYXRhID1cbiAgICAgIHR5cGUgPT09ICdwdWJsaWMnXG4gICAgICAgID8gYXdhaXQgdGhpcy5jbGllbnQucmVzdC5lbmRwb2ludHMuZ2V0UHVibGljQXJjaGl2ZWRUaHJlYWRzKFxuICAgICAgICAgICAgdGhpcy5pZCxcbiAgICAgICAgICAgIHBhcmFtc1xuICAgICAgICAgIClcbiAgICAgICAgOiBhd2FpdCB0aGlzLmNsaWVudC5yZXN0LmVuZHBvaW50cy5nZXRQcml2YXRlQXJjaGl2ZWRUaHJlYWRzKFxuICAgICAgICAgICAgdGhpcy5pZCxcbiAgICAgICAgICAgIHBhcmFtc1xuICAgICAgICAgIClcblxuICAgIGNvbnN0IHRocmVhZHM6IFRocmVhZENoYW5uZWxbXSA9IFtdXG4gICAgY29uc3QgbWVtYmVyczogVGhyZWFkTWVtYmVyW10gPSBbXVxuXG4gICAgZm9yIChjb25zdCBkIG9mIGRhdGEudGhyZWFkcykge1xuICAgICAgYXdhaXQgdGhpcy50aHJlYWRzLnNldChkLmlkLCBkKVxuICAgICAgdGhyZWFkcy5wdXNoKChhd2FpdCB0aGlzLnRocmVhZHMuZ2V0KGQuaWQpKSEpXG4gICAgfVxuXG4gICAgZm9yIChjb25zdCBkIG9mIGRhdGEubWVtYmVycykge1xuICAgICAgY29uc3QgdGhyZWFkID1cbiAgICAgICAgdGhyZWFkcy5maW5kKChlKSA9PiBlLmlkID09PSBkLmlkKSA/PyAoYXdhaXQgdGhpcy50aHJlYWRzLmdldChkLmlkKSlcbiAgICAgIGlmICh0aHJlYWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCB0aHJlYWQubWVtYmVycy5zZXQoZC51c2VyX2lkLCBkKVxuICAgICAgICBtZW1iZXJzLnB1c2goKGF3YWl0IHRocmVhZC5tZW1iZXJzLmdldChkLnVzZXJfaWQpKSEpXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRocmVhZHMsXG4gICAgICBtZW1iZXJzLFxuICAgICAgaGFzTW9yZTogZGF0YS5oYXNfbW9yZVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGZldGNoUHVibGljQXJjaGl2ZWRUaHJlYWRzKFxuICAgIHBhcmFtczogeyBiZWZvcmU/OiBzdHJpbmc7IGxpbWl0PzogbnVtYmVyIH0gPSB7fVxuICApOiBQcm9taXNlPHtcbiAgICB0aHJlYWRzOiBUaHJlYWRDaGFubmVsW11cbiAgICBtZW1iZXJzOiBUaHJlYWRNZW1iZXJbXVxuICAgIGhhc01vcmU6IGJvb2xlYW5cbiAgfT4ge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmZldGNoQXJjaGl2ZWRUaHJlYWRzKCdwdWJsaWMnLCBwYXJhbXMpXG4gIH1cblxuICBhc3luYyBmZXRjaFByaXZhdGVBcmNoaXZlZFRocmVhZHMoXG4gICAgcGFyYW1zOiB7IGJlZm9yZT86IHN0cmluZzsgbGltaXQ/OiBudW1iZXIgfSA9IHt9XG4gICk6IFByb21pc2U8e1xuICAgIHRocmVhZHM6IFRocmVhZENoYW5uZWxbXVxuICAgIG1lbWJlcnM6IFRocmVhZE1lbWJlcltdXG4gICAgaGFzTW9yZTogYm9vbGVhblxuICB9PiB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZmV0Y2hBcmNoaXZlZFRocmVhZHMoJ3ByaXZhdGUnLCBwYXJhbXMpXG4gIH1cblxuICBhc3luYyBmZXRjaEpvaW5lZFByaXZhdGVBcmNoaXZlZFRocmVhZHMoXG4gICAgcGFyYW1zOiB7IGJlZm9yZT86IHN0cmluZzsgbGltaXQ/OiBudW1iZXIgfSA9IHt9XG4gICk6IFByb21pc2U8e1xuICAgIHRocmVhZHM6IFRocmVhZENoYW5uZWxbXVxuICAgIG1lbWJlcnM6IFRocmVhZE1lbWJlcltdXG4gICAgaGFzTW9yZTogYm9vbGVhblxuICB9PiB7XG4gICAgY29uc3QgZGF0YSA9XG4gICAgICBhd2FpdCB0aGlzLmNsaWVudC5yZXN0LmVuZHBvaW50cy5nZXRKb2luZWRQcml2YXRlQXJjaGl2ZWRUaHJlYWRzKFxuICAgICAgICB0aGlzLmlkLFxuICAgICAgICBwYXJhbXNcbiAgICAgIClcblxuICAgIGNvbnN0IHRocmVhZHM6IFRocmVhZENoYW5uZWxbXSA9IFtdXG4gICAgY29uc3QgbWVtYmVyczogVGhyZWFkTWVtYmVyW10gPSBbXVxuXG4gICAgZm9yIChjb25zdCBkIG9mIGRhdGEudGhyZWFkcykge1xuICAgICAgYXdhaXQgdGhpcy50aHJlYWRzLnNldChkLmlkLCBkKVxuICAgICAgdGhyZWFkcy5wdXNoKChhd2FpdCB0aGlzLnRocmVhZHMuZ2V0KGQuaWQpKSEpXG4gICAgfVxuXG4gICAgZm9yIChjb25zdCBkIG9mIGRhdGEubWVtYmVycykge1xuICAgICAgY29uc3QgdGhyZWFkID1cbiAgICAgICAgdGhyZWFkcy5maW5kKChlKSA9PiBlLmlkID09PSBkLmlkKSA/PyAoYXdhaXQgdGhpcy50aHJlYWRzLmdldChkLmlkKSlcbiAgICAgIGlmICh0aHJlYWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhd2FpdCB0aHJlYWQubWVtYmVycy5zZXQoZC51c2VyX2lkLCBkKVxuICAgICAgICBtZW1iZXJzLnB1c2goKGF3YWl0IHRocmVhZC5tZW1iZXJzLmdldChkLnVzZXJfaWQpKSEpXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRocmVhZHMsXG4gICAgICBtZW1iZXJzLFxuICAgICAgaGFzTW9yZTogZGF0YS5oYXNfbW9yZVxuICAgIH1cbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLFNBQVMscUJBQXFCLFFBQVEsZ0NBQStCO0FBT3JFLFNBQVMsT0FBTyxRQUFRLHVCQUFzQjtBQUM5QyxTQUFTLFlBQVksUUFBUSxlQUFjO0FBZTNDLE9BQU8sTUFBTSxvQ0FBb0M7SUFDL0MsTUFBYztJQUNkLFNBQWlCO0lBQ2pCLHNCQUE4QjtJQUM5QiwyQkFBbUM7SUFDbkMsUUFBOEI7SUFFOUIsWUFDRSxNQUFjLEVBQ2QsSUFBd0MsRUFDeEMsS0FBWSxDQUNaO1FBQ0EsS0FBSyxDQUFDLFFBQVEsTUFBTTtRQUNwQixJQUFJLENBQUMsWUFBWSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxzQkFDakIsSUFBSSxDQUFDLE1BQU0sRUFDWCxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFDbEIsSUFBSTtJQUVSO0lBRUEsYUFBYSxJQUF3QyxFQUFRO1FBQzNELEtBQUssQ0FBQyxZQUFZLENBQUM7UUFDbkIsSUFBSSxDQUFDLHFCQUFxQixHQUN4QixLQUFLLGtDQUFrQyxJQUFJLElBQUksQ0FBQyxxQkFBcUI7UUFDdkUsSUFBSSxDQUFDLDBCQUEwQixHQUM3QixLQUFLLDZCQUE2QixJQUFJLElBQUks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