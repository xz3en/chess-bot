import { User } from '../../structures/user.ts';
import { GatewayIntents } from '../../types/gateway.ts';
export const ready = async (gateway, d)=>{
    gateway._guildsToBeLoaded = gateway.client.intents.includes(GatewayIntents.GUILDS) === true ? d.guilds.length : 0;
    gateway._guildsLoaded = 0;
    gateway.client.upSince = new Date();
    if ('application' in d) {
        gateway.client.applicationID = d.application.id;
        gateway.client.applicationFlags = d.application.flags;
    }
    await gateway.client.users.set(d.user.id, d.user);
    gateway.client.user = new User(gateway.client, d.user);
    gateway.sessionID = d.session_id;
    gateway.debug(`Received READY. Session: ${gateway.sessionID}`);
    await gateway.cache.set('session_id', gateway.sessionID);
    for (const guild of d.guilds){
        await gateway.client.guilds.set(guild.id, guild);
    }
    gateway._resolveReadyReceived?.();
    gateway.client.emit('shardReady', gateway.shards?.[0] ?? 0);
    gateway._checkGuildsLoaded(false);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvaGFybW9ueUB2Mi45LjAvc3JjL2dhdGV3YXkvaGFuZGxlcnMvcmVhZHkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVXNlciB9IGZyb20gJy4uLy4uL3N0cnVjdHVyZXMvdXNlci50cydcbmltcG9ydCB7IEdhdGV3YXlJbnRlbnRzLCBSZWFkeSB9IGZyb20gJy4uLy4uL3R5cGVzL2dhdGV3YXkudHMnXG5pbXBvcnQgdHlwZSB7IEdhdGV3YXksIEdhdGV3YXlFdmVudEhhbmRsZXIgfSBmcm9tICcuLi9tb2QudHMnXG5cbmV4cG9ydCBjb25zdCByZWFkeTogR2F0ZXdheUV2ZW50SGFuZGxlciA9IGFzeW5jIChcbiAgZ2F0ZXdheTogR2F0ZXdheSxcbiAgZDogUmVhZHlcbikgPT4ge1xuICBnYXRld2F5Ll9ndWlsZHNUb0JlTG9hZGVkID1cbiAgICBnYXRld2F5LmNsaWVudC5pbnRlbnRzIS5pbmNsdWRlcyhHYXRld2F5SW50ZW50cy5HVUlMRFMpID09PSB0cnVlXG4gICAgICA/IGQuZ3VpbGRzLmxlbmd0aFxuICAgICAgOiAwXG4gIGdhdGV3YXkuX2d1aWxkc0xvYWRlZCA9IDBcbiAgZ2F0ZXdheS5jbGllbnQudXBTaW5jZSA9IG5ldyBEYXRlKClcblxuICBpZiAoJ2FwcGxpY2F0aW9uJyBpbiBkKSB7XG4gICAgZ2F0ZXdheS5jbGllbnQuYXBwbGljYXRpb25JRCA9IGQuYXBwbGljYXRpb24uaWRcbiAgICBnYXRld2F5LmNsaWVudC5hcHBsaWNhdGlvbkZsYWdzID0gZC5hcHBsaWNhdGlvbi5mbGFnc1xuICB9XG5cbiAgYXdhaXQgZ2F0ZXdheS5jbGllbnQudXNlcnMuc2V0KGQudXNlci5pZCwgZC51c2VyKVxuXG4gIGdhdGV3YXkuY2xpZW50LnVzZXIgPSBuZXcgVXNlcihnYXRld2F5LmNsaWVudCwgZC51c2VyKVxuICBnYXRld2F5LnNlc3Npb25JRCA9IGQuc2Vzc2lvbl9pZFxuICBnYXRld2F5LmRlYnVnKGBSZWNlaXZlZCBSRUFEWS4gU2Vzc2lvbjogJHtnYXRld2F5LnNlc3Npb25JRH1gKVxuXG4gIGF3YWl0IGdhdGV3YXkuY2FjaGUuc2V0KCdzZXNzaW9uX2lkJywgZ2F0ZXdheS5zZXNzaW9uSUQpXG5cbiAgZm9yIChjb25zdCBndWlsZCBvZiBkLmd1aWxkcykge1xuICAgIGF3YWl0IGdhdGV3YXkuY2xpZW50Lmd1aWxkcy5zZXQoZ3VpbGQuaWQsIGd1aWxkKVxuICB9XG5cbiAgZ2F0ZXdheS5fcmVzb2x2ZVJlYWR5UmVjZWl2ZWQ/LigpXG5cbiAgZ2F0ZXdheS5jbGllbnQuZW1pdCgnc2hhcmRSZWFkeScsIGdhdGV3YXkuc2hhcmRzPy5bMF0gPz8gMClcbiAgZ2F0ZXdheS5fY2hlY2tHdWlsZHNMb2FkZWQoZmFsc2UpXG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsU0FBUyxJQUFJLFFBQVEsMkJBQTBCO0FBQy9DLFNBQVMsY0FBYyxRQUFlLHlCQUF3QjtBQUc5RCxPQUFPLE1BQU0sUUFBNkIsT0FDeEMsU0FDQSxJQUNHO0lBQ0gsUUFBUSxpQkFBaUIsR0FDdkIsUUFBUSxNQUFNLENBQUMsT0FBTyxDQUFFLFFBQVEsQ0FBQyxlQUFlLE1BQU0sTUFBTSxJQUFJLEdBQzVELEVBQUUsTUFBTSxDQUFDLE1BQU0sR0FDZixDQUFDO0lBQ1AsUUFBUSxhQUFhLEdBQUc7SUFDeEIsUUFBUSxNQUFNLENBQUMsT0FBTyxHQUFHLElBQUk7SUFFN0IsSUFBSSxpQkFBaUIsR0FBRztRQUN0QixRQUFRLE1BQU0sQ0FBQyxhQUFhLEdBQUcsRUFBRSxXQUFXLENBQUMsRUFBRTtRQUMvQyxRQUFRLE1BQU0sQ0FBQyxnQkFBZ0IsR0FBRyxFQUFFLFdBQVcsQ0FBQyxLQUFLO0lBQ3ZELENBQUM7SUFFRCxNQUFNLFFBQVEsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLEVBQUUsSUFBSTtJQUVoRCxRQUFRLE1BQU0sQ0FBQyxJQUFJLEdBQUcsSUFBSSxLQUFLLFFBQVEsTUFBTSxFQUFFLEVBQUUsSUFBSTtJQUNyRCxRQUFRLFNBQVMsR0FBRyxFQUFFLFVBQVU7SUFDaEMsUUFBUSxLQUFLLENBQUMsQ0FBQyx5QkFBeUIsRUFBRSxRQUFRLFNBQVMsQ0FBQyxDQUFDO0lBRTdELE1BQU0sUUFBUSxLQUFLLENBQUMsR0FBRyxDQUFDLGNBQWMsUUFBUSxTQUFTO0lBRXZELEtBQUssTUFBTSxTQUFTLEVBQUUsTUFBTSxDQUFFO1FBQzVCLE1BQU0sUUFBUSxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsRUFBRTtJQUM1QztJQUVBLFFBQVEscUJBQXFCO0lBRTdCLFFBQVEsTUFBTSxDQUFDLElBQUksQ0FBQyxjQUFjLFFBQVEsTUFBTSxFQUFFLENBQUMsRUFBRSxJQUFJO0lBQ3pELFFBQVEsa0JBQWtCLENBQUMsS0FBSztBQUNsQyxFQUFDIn0=